{
  "name": "æ¥½å¤©å¸‚å ´ vs Amazon ReCommerce ä¾¡æ ¼æ¯”è¼ƒ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "â° å®šæœŸå®Ÿè¡Œ (6æ™‚é–“æ¯)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "keyword",
              "name": "keyword",
              "value": "iPhone 15",
              "type": "string"
            },
            {
              "id": "applicationId",
              "name": "applicationId",
              "value": "1004649499121188262",
              "type": "string"
            }
          ]
        }
      },
      "id": "set-params",
      "name": "ğŸ”§ æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        220,
        0
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://app.rakuten.co.jp/services/api/IchibaItem/Search/20220601",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "applicationId",
              "value": "={{ $json.applicationId }}"
            },
            {
              "name": "keyword",
              "value": "={{ $json.keyword }}"
            },
            {
              "name": "hits",
              "value": "30"
            }
          ]
        },
        "options": {}
      },
      "id": "rakuten-api",
      "name": "ğŸ›’ æ¥½å¤©å¸‚å ´API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        440,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "// æ¥½å¤©APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºï¼ˆã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼é™¤å¤–ï¼‰\nconst items = $input.first().json.Items || [];\n\n// é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼é¡ï¼‰\nconst excludeKeywords = [\n  'ã‚±ãƒ¼ã‚¹', 'ã‚«ãƒãƒ¼', 'ãƒ•ã‚£ãƒ«ãƒ ', 'ã‚¬ãƒ©ã‚¹', 'ã‚·ãƒ¼ãƒˆ',\n  'ã‚¹ãƒˆãƒ©ãƒƒãƒ—', 'ãƒ›ãƒ«ãƒ€ãƒ¼', 'ã‚¹ã‚¿ãƒ³ãƒ‰', 'ãƒãƒ¼ãƒ', 'ãƒãƒ³ãƒ‰',\n  'ã‚·ãƒ¼ãƒ«', 'ã‚¹ãƒ†ãƒƒã‚«ãƒ¼', 'ãƒªãƒ³ã‚°', 'ã‚°ãƒªãƒƒãƒ—', 'ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼',\n  'ã‚¯ãƒ­ã‚¹', 'ã‚·ãƒ³ãƒ—ãƒ«', 'ãƒ¬ã‚¸ãƒ³', 'ãƒ‡ã‚³', 'ELECOM', 'ã‚¨ãƒ¬ã‚³ãƒ ',\n  'å……é›»å™¨', 'ã‚±ãƒ¼ãƒ–ãƒ«', 'ã‚¤ãƒ¤ãƒ›ãƒ³', 'ã‚¯ãƒªãƒ¼ãƒŠãƒ¼', '100å††'\n];\n\n// æœ€ä½ä¾¡æ ¼ï¼ˆæœ¬ä½“ä¾¡æ ¼å¸¯ã‚’æƒ³å®šï¼š5ä¸‡å††ä»¥ä¸Šï¼‰\nconst minPrice = 50000;\n\nconst filtered = items.filter(item => {\n  const name = item.Item.itemName;\n  const price = item.Item.itemPrice;\n  \n  // ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€å•†å“ã‚’é™¤å¤–\n  const isAccessory = excludeKeywords.some(kw => name.includes(kw));\n  \n  // ä¾¡æ ¼ãŒå®‰ã™ãã‚‹å•†å“ã‚’é™¤å¤–ï¼ˆæœ¬ä½“ä¾¡æ ¼å¸¯ã®ã¿ï¼‰\n  const isPriceReasonable = price >= minPrice;\n  \n  return !isAccessory && isPriceReasonable;\n});\n\nreturn filtered.map(item => {\n  const i = item.Item;\n  return {\n    json: {\n      source: 'æ¥½å¤©å¸‚å ´',\n      name: i.itemName,\n      price: i.itemPrice,\n      url: i.itemUrl,\n      shop: i.shopName,\n      availability: i.availability === 1 ? 'åœ¨åº«ã‚ã‚Š' : 'åœ¨åº«ãªã—'\n    }\n  };\n});"
      },
      "id": "parse-rakuten",
      "name": "ğŸ“¦ æ¥½å¤©ãƒ‡ãƒ¼ã‚¿æ•´å½¢",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        660,
        0
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://www.recommerce.co.jp/expensive/search_result.php",
        "authentication": "none",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "word",
              "value": "={{ $json.keyword }}"
            },
            {
              "name": "category_selection",
              "value": ""
            }
          ]
        },
        "options": {
          "responseFormat": "string",
          "headerParameters": {
            "parameters": [
              {
                "name": "User-Agent",
                "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
              }
            ]
          }
        }
      },
      "id": "recommerce-http",
      "name": "ğŸ•·ï¸ Amazon ReCommerceå–å¾—",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        440,
        220
      ]
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "dataPropertyName": "data",
        "extractionValues": {
          "values": [
            {
              "key": "name",
              "cssSelector": "td.li_title",
              "returnArray": true
            },
            {
              "key": "price_range",
              "cssSelector": "td.li_price",
              "returnArray": true
            }
          ]
        },
        "options": {
          "trimValues": true
        }
      },
      "id": "extract-html",
      "name": "ğŸ“„ HTMLæŠ½å‡º",
      "type": "n8n-nodes-base.htmlExtract",
      "typeVersion": 1,
      "position": [
        600,
        220
      ]
    },
    {
      "parameters": {
        "jsCode": "// ReCommerceãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢\nconst items = $input.all();\nconst products = [];\n\n// HTML Extractã®çµæœã¯é…åˆ—ã®é…åˆ—ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚å±•é–‹\nconst names = items[0].json.name || [];\nconst priceRanges = items[0].json.price_range || [];\n\nfor (let i = 0; i < names.length; i++) {\n  const name = names[i];\n  const priceRange = priceRanges[i];\n  \n  if (!name || (!name.includes('iPhone') && !name.includes('Pixel'))) continue;\n  \n  // ä¾¡æ ¼æŠ½å‡º: \"è²·å–ä¾¡æ ¼ï¼š44,625å††ï½89,250å††\" -> 89250\n  const parsePrice = (str) => {\n    if (!str) return { min: 0, max: 0 };\n    const clean = str.replace('è²·å–ä¾¡æ ¼ï¼š', '');\n    const parts = clean.split('ï½');\n    const min = parseInt(parts[0].replace(/[^0-9]/g, ''), 10) || 0;\n    const max = parts[1] ? parseInt(parts[1].replace(/[^0-9]/g, ''), 10) : min;\n    return { min, max };\n  };\n  \n  const { min, max } = parsePrice(priceRange);\n  \n  // ä¸Šé™è²·å–ä¾¡æ ¼ã‚’æ¡ç”¨\n  if (max >= 10000) {\n    products.push({\n      json: {\n        source: 'Amazon ReCommerce',\n        name: name,\n        price: max,\n        price_min: min,\n        url: 'https://www.recommerce.co.jp/',\n        shop: 'Amazon ReCommerce',\n        condition: 'HPä¸Šé™ä¾¡æ ¼'\n      }\n    });\n  }\n}\n\nreturn products.length > 0 ? products : [{ json: { message: 'Amazon ReCommerceã®å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' } }];"
      },
      "id": "format-recommerce-data",
      "name": "ğŸ“¦ ReCommerceãƒ‡ãƒ¼ã‚¿æ•´å½¢",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        760,
        220
      ]
    },
    {
      "parameters": {
        "mode": "append"
      },
      "id": "merge-data",
      "name": "ğŸ”„ ãƒ‡ãƒ¼ã‚¿çµ±åˆ",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        880,
        100
      ]
    },
    {
      "parameters": {
        "jsCode": "// ä¾¡æ ¼æ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã›ã©ã‚Šåˆ©ç›Šè¨ˆç®—ï¼‰\nconst items = $input.all();\nconst results = [];\nconst threshold = 2000; // åˆ©ç›Šã®é–¾å€¤ï¼ˆå††ï¼‰\n\n// æ¥½å¤©ã¨Amazon ReCommerceã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é¡\nconst rakutenItems = items.filter(i => i.json.source === 'æ¥½å¤©å¸‚å ´');\nconst amazonItems = items.filter(i => i.json.source === 'Amazon ReCommerce');\n\nconsole.log('æ¥½å¤©å•†å“æ•°:', rakutenItems.length);\nconsole.log('Amazonå•†å“æ•°:', amazonItems.length);\n\n// ã‚¹ãƒšãƒƒã‚¯æŠ½å‡ºé–¢æ•°\nfunction extractSpecs(name) {\n  const specs = {\n    model: '',\n    storage: '',\n    condition: ''\n  };\n  \n  // ãƒ¢ãƒ‡ãƒ«åˆ¤å®š\n  if (name.includes('Pro Max') || name.includes('ProMax')) {\n    specs.model = 'iPhone 15 Pro Max';\n  } else if (name.includes('Pro')) {\n    specs.model = 'iPhone 15 Pro';\n  } else if (name.includes('15') && !name.includes('Plus')) {\n    specs.model = 'iPhone 15';\n  } else if (name.includes('Plus')) {\n    specs.model = 'iPhone 15 Plus';\n  }\n  \n  // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åˆ¤å®š\n  if (name.includes('512GB') || name.includes('512gb')) {\n    specs.storage = '512GB';\n  } else if (name.includes('256GB') || name.includes('256gb')) {\n    specs.storage = '256GB';\n  } else if (name.includes('128GB') || name.includes('128gb')) {\n    specs.storage = '128GB';\n  } else if (name.includes('1TB') || name.includes('1tb')) {\n    specs.storage = '1TB';\n  }\n  \n  return specs;\n}\n\n// ã‚¹ãƒšãƒƒã‚¯æ¯”è¼ƒ\nfor (const amazon of amazonItems) {\n  const amzSpecs = extractSpecs(amazon.json.name);\n  \n  // ã‚¹ãƒšãƒƒã‚¯ãŒæŠ½å‡ºã§ããªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n  if (!amzSpecs.model || !amzSpecs.storage) continue;\n  \n  for (const rakuten of rakutenItems) {\n    const rakutenSpecs = extractSpecs(rakuten.json.name);\n    \n    // åŒä¸€ã‚¹ãƒšãƒƒã‚¯ï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ»å®¹é‡ï¼‰ã®ã¿æ¯”è¼ƒ\n    // è§£èª¬: Amazonå´ã¯ã€Œä¸Šé™è²·å–ä¾¡æ ¼ã€ãªã®ã§ã€æ¥½å¤©å´ã¯ã€Œæ–°å“ã€ã«è¿‘ã„ã‚‚ã®ã¨æ¯”è¼ƒã™ã‚‹ã®ãŒå®‰å…¨ã ãŒã€\n    // ã“ã“ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã‚¹ãƒšãƒƒã‚¯ä¸€è‡´ã®ã¿ã§æ¯”è¼ƒã—ã€è©³ç´°ã¯äººé–“ãŒåˆ¤æ–­ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚\n    if (amzSpecs.model === rakutenSpecs.model && \n        amzSpecs.storage === rakutenSpecs.storage) {\n      \n      // åˆ©ç›Šè¨ˆç®— = Amazonè²·å–ä¾¡æ ¼ - æ¥½å¤©è²©å£²ä¾¡æ ¼\n      const profit = amazon.json.price - rakuten.json.price;\n      \n      // åˆ©ç›ŠãŒé–¾å€¤ä»¥ä¸Šã®å ´åˆã®ã¿çµæœã«è¿½åŠ \n      if (profit >= threshold) {\n        results.push({\n          json: {\n            æ¯”è¼ƒæ—¥æ™‚: new Date().toISOString(),\n            ãƒ¢ãƒ‡ãƒ«: amzSpecs.model,\n            å®¹é‡: amzSpecs.storage,\n            å•†å“å_Amazon: amazon.json.name,\n            å•†å“å_æ¥½å¤©: rakuten.json.name,\n            è²·å–ä¾¡æ ¼_Amazon: amazon.json.price,\n            è²©å£²ä¾¡æ ¼_æ¥½å¤©: rakuten.json.price,\n            æƒ³å®šå·®ç›Š: profit,\n            åˆ¤å®š: 'åˆ©ç›Šã‚ã‚Š',\n            URL_Amazon: amazon.json.url,\n            URL_æ¥½å¤©: rakuten.json.url\n          }\n        });\n      }\n    }\n  }\n}\n\n// çµæœãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\nif (results.length === 0) {\n  return [{\n    json: {\n      message: 'åŒä¸€ã‚¹ãƒšãƒƒã‚¯ã§åˆ©ç›Š' + threshold + 'å††ä»¥ä¸Šã®å•†å“ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ',\n      debug_æ¥½å¤©ä»¶æ•°: rakutenItems.length,\n      debug_Amazonä»¶æ•°: amazonItems.length\n    }\n  }];\n}\n\nreturn results;"
      },
      "id": "compare-prices",
      "name": "ğŸ“Š ä¾¡æ ¼æ¯”è¼ƒ (å·®é¡2000å††ä»¥ä¸Š)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        100
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "filter-has-diff",
              "leftValue": "={{ $json.æƒ³å®šå·®ç›Š }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": ">="
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter-results",
      "name": "âœ… çµæœãƒ•ã‚£ãƒ«ã‚¿",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        1320,
        100
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1AW1qnLR122W1UXD3fSme0jVJdcuVjocAMeuJlLkamlg",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "ä¾¡æ ¼æ¯”è¼ƒçµæœ",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {}
        },
        "options": {}
      },
      "id": "google-sheets",
      "name": "ğŸ“ Google Sheetså‡ºåŠ›",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1540,
        100
      ]
    }
  ],
  "connections": {
    "â° å®šæœŸå®Ÿè¡Œ (6æ™‚é–“æ¯)": {
      "main": [
        [
          {
            "node": "ğŸ”§ æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”§ æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š": {
      "main": [
        [
          {
            "node": "ğŸ›’ æ¥½å¤©å¸‚å ´API",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ•·ï¸ Amazon ReCommerceå–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ›’ æ¥½å¤©å¸‚å ´API": {
      "main": [
        [
          {
            "node": "ğŸ“¦ æ¥½å¤©ãƒ‡ãƒ¼ã‚¿æ•´å½¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ æ¥½å¤©ãƒ‡ãƒ¼ã‚¿æ•´å½¢": {
      "main": [
        [
          {
            "node": "ğŸ”„ ãƒ‡ãƒ¼ã‚¿çµ±åˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ•·ï¸ Amazon ReCommerceå–å¾—": {
      "main": [
        [
          {
            "node": "ğŸ“„ HTMLæŠ½å‡º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ HTMLæŠ½å‡º": {
      "main": [
        [
          {
            "node": "ğŸ“¦ ReCommerceãƒ‡ãƒ¼ã‚¿æ•´å½¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ ReCommerceãƒ‡ãƒ¼ã‚¿æ•´å½¢": {
      "main": [
        [
          {
            "node": "ğŸ”„ ãƒ‡ãƒ¼ã‚¿çµ±åˆ",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”„ ãƒ‡ãƒ¼ã‚¿çµ±åˆ": {
      "main": [
        [
          {
            "node": "ğŸ“Š ä¾¡æ ¼æ¯”è¼ƒ (å·®é¡2000å††ä»¥ä¸Š)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š ä¾¡æ ¼æ¯”è¼ƒ (å·®é¡2000å††ä»¥ä¸Š)": {
      "main": [
        [
          {
            "node": "âœ… çµæœãƒ•ã‚£ãƒ«ã‚¿",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… çµæœãƒ•ã‚£ãƒ«ã‚¿": {
      "main": [
        [
          {
            "node": "ğŸ“ Google Sheetså‡ºåŠ›",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2026-01-25T00:00:00.000Z",
  "versionId": "1"
}